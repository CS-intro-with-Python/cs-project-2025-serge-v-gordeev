<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KSP delta-v calculator</title>
    <style>
        table {
            border-collapse: collapse;
            width: 600px;
            border: 1px solid #ccc;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            width: 200px;
        }
        select, input[type="text"] {
            width: 150px;
            box-sizing: border-box;
        }
    </style>
    <meta charset="UTF-8">
</head>
<body>

<script>
    let n = 1;
    var array = ["Kerbol", "Moho", "Eve", "Gilly", "Kerbin", "Mun", "Minmus", "Duna", "Ike",
    "Dres", "Jool", "Laythe", "Tylo", "Vall", "Pol", "Bop", "Eeloo"];
    async function sendRequest()
    {
        let points = [];

        for (var i = 1; i < (n+1); i++) {
            const select_name = "select" + i;
            const text_name = "text" + i;
            const check_name = "check" + i;
            const planet_name = document.getElementById(select_name).value;
            const altitude = document.getElementById(text_name).value;
            let capture_burn = false;
            if (i != 1) {
                capture_burn = document.getElementById(check_name).checked;
            }

            points.push({ location: planet_name, alt: altitude, capture: capture_burn })
        }

        try {
            const response = await fetch('/test',
            {
                method: 'POST',
                headers: {
                   'Accept': 'application/json',
                   'Content-Type': 'application/json'
                },
                body: JSON.stringify(points)
            });

            if (!response.ok)
            {
                throw new Error(`Error: ${response.status}`);
            }
            else
            {
                let result = await response.json();
                document.getElementById('output').innerHTML = result.dv;
            }


        } catch (err) {
            console.error("Request failed:", err);
        }
    }

    function appendPoint() {
        n++;
        const cell1 = document.createElement("td");
        const cell2 = document.createElement("td");
        const cell3 = document.createElement("td");
        const row = document.createElement("tr");

        const sel = document.createElement("select");
        sel.id = "select" + n;

        for (var i = 0; i < array.length; i++) {
            var option = document.createElement("option");
            option.value = array[i];
            option.text = array[i];
            sel.appendChild(option);
        }
        const inp = document.createElement("input");
        inp.type = "text";
        inp.id = "text" + n;

        const check = document.createElement("input");
        check.type = "checkbox";
        check.id = "check" + n;

        cell1.appendChild(sel);
        cell2.appendChild(inp);
        cell3.appendChild(check);
        row.appendChild(cell1);
        row.appendChild(cell2);
        row.appendChild(cell3);

        document.getElementById("tbl").appendChild(row);
    }

    function removePoint() {
        if (n > 1) {
            n--;
            const lastChild = document.getElementById("tbl").lastElementChild;
            lastChild.remove();
        }
    }
</script>

<table id="tbl">
    <tr>
        <td>
            <button onclick="sendRequest()">Calculate</button>
        </td>
        <td>
            <p id="output">  </p>
        </td>
    </tr>
    <tr>
        <th> Planet </th>
        <th> Orbital altitude </th>
        <th> Include capture burn </th>
    </tr>
    <tr>
        <td>
            <select id="select1">
                <option value="Kerbol">Kerbol</option>
                <option value="Moho">Moho</option>
                <option value="Eve">Eve</option>
                <option value="Gilly">Gilly</option>
                <option value="Kerbin">Kerbin</option>
                <option value="Mun">Mun</option>
                <option value="Minmus">Minmus</option>
                <option value="Duna">Duna</option>
                <option value="Ike">Ike</option>
                <option value="Dres">Dres</option>
                <option value="Jool">Jool</option>
                <option value="Laythe">Laythe</option>
                <option value="Vall">Vall</option>
                <option value="Tylo">Tylo</option>
                <option value="Pol">Bop</option>
                <option value="Bop">Pol</option>
                <option value="Eeloo">Eeloo</option>
            </select>
        </td>
        <td>
            <input type="text" id="text1">
        </td>
        <td>

        </td>
    </tr>
</table>

<button onclick="appendPoint()">Add</button>
<button onclick="removePoint()">Remove</button>

</body>
</html>
